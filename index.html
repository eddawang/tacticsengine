<!DOCTYPE html>
<html>
    
    <head>
        <title>Test</title>
        <script src='https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js'></script>
        <script src='tile.js'></script>
        <script src='unit.js'></script>
        <script src='draw.js'></script>
        <link rel="stylesheet" type="text/css" href="index.css">
    </head>
    
    <body>
        <div class='mapGrid'></div>
        <script>
            var _selected;
            var _selectedRange;
            //Generate map
            _genSquareMap(20,20,_map);
            _map["9,9"].terrain = 'blank';
            _map["7,7"].terrain = 'asdf';
            
            //Generate units
            var unit1 = new unit('A');
            var unit2 = new unit('B');
            
            //Place units on map
            _placeUnit(unit1, 8,8, _map);
            _placeUnit(unit2, 10,10, _map);
            
            //Draw
            _drawMap('.mapGrid', _map);
            _drawUnits(_map);
            
            //Clickers
            $('.tile').on('click', function(e){
                if(e.target == this){
                    var tile = _map[e.target.id];
                    if(_selected){
                        var walk = e.target.attributes.getNamedItem('walk');
                        if(walk){
                            var unit = _selected;
                            toggleSelectUnit(_selected);
                            moveUnit(unit, tile);
                        }
                    }
                }
            });

            $('.unit').on('click', function(e){
                var unit = _map.units[e.target.id];
                var tile = unit.tile;
                var walkable = traverseRadial(4, tile, 0).tiles;
                
                toggleSelectUnit(unit, walkable);
            });
            
            function toggleSelectUnit(unit, tileRange){
                var s = unit.selected;
                if(_selected){
                    unsetRange(_selectedRange,'walk');
                    _selected.selected = false;
                    _selected = null;
                    delete _selectedRange;
                }
                if(!s){
                    setRange(tileRange, {walk:true});
                    unit.selected = true;
                    _selected = unit;
                    _selectedRange = tileRange;
                }
            
            }
            
            function moveUnit(unit, targetTile){
                unit.tile.onTile = null;
                unit.tile = targetTile;
                targetTile.onTile = unit;
                $('#'+unit.id).appendTo(idSelect(targetTile.loc));
            }
            
        </script>
        
        <script>
            
        </script>
        
    </body>
    
</html>
